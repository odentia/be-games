# Стратегия массовой синхронизации игр

## Проблема
У вас есть только **20000 запросов** к RAWG API, но нужно хранить все игры в базе данных для пользователей.

## Решение: Оптимизированная массовая синхронизация

### Стратегия запросов

**Дешевые запросы (рекомендуется):**
- `GET /games` - список игр (1 запрос на страницу, до 40 игр)
- Возвращает краткую информацию: название, рейтинг, платформы, жанры, скриншоты

**Дорогие запросы (используйте экономно):**
- `GET /games/{id}` - детальная информация об игре (1 запрос на игру)
- `GET /games/{id}/screenshots` - скриншоты (1 запрос на игру)
- **Итого: 2 запроса на игру для полной информации**

### Рекомендуемый подход

#### Вариант 1: Только краткая информация (максимум игр)
```json
{
  "start_page": 1,
  "pages": 500,
  "page_size": 40,
  "load_details": false
}
```
- **Запросов:** 500 (1 на страницу)
- **Игр в базе:** ~20,000
- **Что есть:** название, рейтинг, платформы, жанры, скриншоты
- **Чего нет:** полное описание, developer, publisher, website

#### Вариант 2: Краткая информация + детали для топ-игр
```json
{
  "start_page": 1,
  "pages": 200,
  "page_size": 40,
  "load_details": true,
  "details_limit": 1000
}
```
- **Запросов:** 200 (список) + 2000 (детали) = 2,200
- **Игр в базе:** ~8,000 (все с краткой информацией)
- **Игр с деталями:** 1,000 (топ-игры)
- **Остаток запросов:** 17,800

#### Вариант 3: Баланс (рекомендуется)
```json
{
  "start_page": 1,
  "pages": 300,
  "page_size": 40,
  "load_details": true,
  "details_limit": 500
}
```
- **Запросов:** 300 (список) + 1,000 (детали) = 1,300
- **Игр в базе:** ~12,000 (все с краткой информацией)
- **Игр с деталями:** 500 (топ-игры)
- **Остаток запросов:** 18,700 (для будущих обновлений)

## Использование API

### Массовая синхронизация

**POST** `/api/v1/games/sync/batch`

**Пример запроса:**
```powershell
$body = @{
    start_page = 1
    pages = 100
    page_size = 40
    load_details = $false
    details_limit = 0
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8010/api/v1/games/sync/batch" -Method POST -Body $body -ContentType "application/json"
```

**Ответ:**
```json
{
  "total_synced": 4000,
  "new_games": 3950,
  "updated_games": 50,
  "details_loaded": 0,
  "requests_used": 100,
  "pages_processed": 100
}
```

### Параметры

- `start_page` (int, default: 1) - Начальная страница для синхронизации
- `pages` (int, default: 1, max: 500) - Количество страниц
- `page_size` (int, default: 40, max: 40) - Размер страницы (RAWG максимум 40)
- `load_details` (bool, default: false) - Загружать детальную информацию
- `details_limit` (int, default: 0) - Максимум игр для загрузки деталей (0 = все на страницах)

## План действий

### Шаг 1: Начальная синхронизация (краткая информация)
```json
{
  "start_page": 1,
  "pages": 500,
  "page_size": 40,
  "load_details": false
}
```
**Результат:** ~20,000 игр в базе, использовано 500 запросов

### Шаг 2: Загрузка деталей для популярных игр
```json
{
  "start_page": 1,
  "pages": 50,
  "page_size": 40,
  "load_details": true,
  "details_limit": 2000
}
```
**Результат:** 2,000 топ-игр с полной информацией, использовано дополнительно 4,000 запросов

**Итого использовано:** 4,500 запросов из 20,000

### Шаг 3: Периодическое обновление
Используйте оставшиеся запросы для:
- Обновления популярных игр (новые скриншоты, рейтинги)
- Добавления новых релизов
- Синхронизации по запросу пользователя (если игра не найдена)

## Оптимизация

1. **Используйте сортировку по рейтингу** (`ordering="-rating"`) - популярные игры сначала
2. **Не загружайте детали для всех игр** - только для топ-игр
3. **Проверяйте существование** - система автоматически пропускает игры с деталями
4. **Используйте пагинацию** - синхронизируйте по частям

## Мониторинг

После каждой синхронизации проверяйте:
- `requests_used` - сколько запросов использовано
- `total_synced` - сколько игр обработано
- `new_games` - сколько новых игр добавлено

## Примеры использования

### Быстрая синхронизация 1000 игр
```json
{
  "start_page": 1,
  "pages": 25,
  "page_size": 40,
  "load_details": false
}
```
**Запросов:** 25

### Синхронизация с деталями для топ-100
```json
{
  "start_page": 1,
  "pages": 3,
  "page_size": 40,
  "load_details": true,
  "details_limit": 100
}
```
**Запросов:** 3 + 200 = 203

### Максимальная синхронизация (все запросы)
```json
{
  "start_page": 1,
  "pages": 500,
  "page_size": 40,
  "load_details": false
}
```
**Запросов:** 500, **Игр:** ~20,000

